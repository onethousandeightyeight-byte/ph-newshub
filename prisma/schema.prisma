// PH-NewsHub - Philippine News Aggregation Platform
// Database Schema with Self-Referencing Categories for Infinite Nesting

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User Model with Role-Based Access Control
model User {
  id               String  @id @default(cuid())
  email            String  @unique
  name             String?
  role             UserRole @default(GUEST)
  stripeCustomerId String?  @unique
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

enum UserRole {
  GUEST
  SUBSCRIBER
  ADMIN
}

// Category Model with Self-Referencing Relation for Infinite Nesting
// Example: Sports > Basketball > PBA > Barangay Ginebra
model Category {
  id        String     @id @default(cuid())
  name      String
  slug      String     @unique
  parentId  String?
  parent    Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: Restrict)
  children  Category[] @relation("CategoryHierarchy")
  articles  Article[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@index([parentId])
  @@index([slug])
}

// News Source Model - Trusted Philippine News Outlets
model Source {
  id          String    @id @default(cuid())
  domainUrl   String    @unique
  name        String?
  isTrusted   Boolean   @default(true)
  articles    Article[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([isTrusted])
}

// Article Model - Core News Content
model Article {
  id          String    @id @default(cuid())
  title       String
  snippet     String
  contentBody String
  wordCount   Int
  originalUrl String    @unique
  publishedAt DateTime
  imageUrl    String?
  categoryId  String
  category    Category  @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  sourceId    String
  source      Source    @relation(fields: [sourceId], references: [id], onDelete: Restrict)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([publishedAt])
  @@index([categoryId])
  @@index([sourceId])
  @@index([wordCount])
}

// Ad Placement Model - Native Advertisement System
model AdPlacement {
  id          String    @id @default(cuid())
  clientName  String
  targetUrl   String
  imageAsset  String
  altText     String?
  isActive    Boolean   @default(true)
  position    Int       // Position in feed (e.g., every 6th item)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([isActive])
  @@index([position])
}
